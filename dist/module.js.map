{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","ThresholdManager","kbn","config","_","moment","panelDefaults","lines","linewidth","fill","points","pointradius","xaxis","show","yaxes","logBase","format","range","from","to","TwoDPanelCtrl","$scope","$injector","$q","$rootScope","panelId","panel","id","thresholdManager","defaultsDeep","plotdata","data","xlabel","timestamps","logScales","unitFormats","getUnitFormats","$tooltip","$","debouncedDraw","debounce","draw","bind","events","on","onInitEditMode","onRender","onDataReceived","onDataError","onPanelTeardown","err","empty","addEditorTab","subTabIndex","length","options","hooks","drawHook","processOffset","processOffsetHook","legend","series","zero","lineWidth","translateFillOption","fillColor","radius","shadowSize","grid","minBorderMargin","markings","backgroundColor","borderWidth","hoverable","clickable","color","margin","left","right","crosshair","mode","addXAxis","addYAxes","plot","throttle","createPlotHoverHandler","styleTheme","renderingCompleted","dataList","target","slice","forEach","xy","ts","maxy","Number","MAX_VALUE","logminy","d","datapoints","val","j","isFinite","push","label","yaxis","stats","max","logmin","render","event","pos","item","dataIndex","y","value","datapoint","x","body","dashboard","formatDate","toPrecision","html","place_tt","pageX","pageY","detach","min","toNumber","defaults","position","index","find","secondY","clone","applyLogScale","configureAxisMode","axis","MIN_VALUE","i","transform","v","Math","log","inverseTransform","pow","ceil","floor","ticks","nextTick","tickDecimals","decimalPlaces","num","toString","split","tickFormatter","valueFormats","scaledDecimals","subItem","getYAxes","formater","isNumber","decimals","$$phase","$digest","yaxisLabel","text","appendTo","gridMargin","panelOptions","bootData","user","lightTheme","css","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {MetricsPanelCtrl} from  'app/plugins/sdk';\nimport {ThresholdManager} from 'app/plugins/panel/graph/threshold_manager';\nimport kbn from 'app/core/utils/kbn';\nimport config from 'app/core/config';\n\nimport _ from 'lodash';\nimport moment from 'moment';\n\nimport './css/style.css!';\n\nconst panelDefaults = {\n  lines: true,\n  linewidth: 1,\n  fill: 1,\n  points: false,\n  pointradius: 5,\n  xaxis: {\n    show: true\n  },\n  yaxes: [\n    {\n      show: true,\n      logBase: 1,\n      format: 'short'\n    },\n    /*{\n      show: true,\n      logBase: 1,\n      format: 'short'\n    }*/\n  ],\n  range: {\n    from: null,\n    to: null\n  }\n};\n\nclass TwoDPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $q, $rootScope) {\n    super($scope, $injector);\n    this.$scope = $scope;\n    this.$rootScope = $rootScope;\n    this.panelId = 'twod' + this.panel.id;\n\n    this.thresholdManager = new ThresholdManager(this);\n\n    // Must use defaultsDeep here to avoid sharing axis, range state as class\n    // variables\n    _.defaultsDeep(this.panel, panelDefaults);\n\n    this.plotdata = {\n      data: [],\n      xlabel: null,\n      timestamps: {}\n    };\n\n    this.logScales = {\n      'linear': 1,\n      'log (base 2)': 2,\n      'log (base 10)': 10,\n      'log (base 32)': 32,\n      'log (base 1024)': 1024\n    };\n\n    this.unitFormats = kbn.getUnitFormats();\n\n    this.$tooltip = $('<div class=\"graph-tooltip\">');\n\n    // Need to debounce plot drawing. Otherwise plot gets drawn with stale\n    // height received from enclosing div. Debouncing give the div time to\n    // achieve a stable height before flot plotting.\n    this.debouncedDraw = _.debounce(this.draw.bind(this), 50);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    //this.events.on('panel-initialized', this.onPanelInitialized.bind(this));\n    //this.events.on('refresh', this.onRefresh.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n  }\n\n  onDataError(err) {\n    //console.log(\"onDataError\", err);\n    $('#' + this.panelId).empty();\n    this.plotdata.data = [];\n    this.plotdata.timestamps = {};\n    this.plotdata.xlabel = null;\n  }\n\n  onPanelInitialized() {\n    //console.log('initialized');\n  }\n\n  onPanelTeardown() {\n    //console.log('teardown');\n    $('#' + this.panelId).empty();\n    //this.$timeout.cancel(this.nextTickPromise);\n  }\n\n  onRefresh() {\n    //console.log('refresh');\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Axes', 'public/plugins/armbrustlab-2dscatter-panel/axes_editor.html', 2);\n    this.addEditorTab('Display', 'public/plugins/armbrustlab-2dscatter-panel/tab_display.html', 3);\n    this.subTabIndex = 0;\n  }\n\n  onRender() {\n    this.debouncedDraw();\n  }\n\n  draw() {\n    $('#' + this.panelId).empty();\n\n    if (this.plotdata.data.length === 0) {\n      return;\n    }\n\n    const options = {\n      hooks: {\n        draw: [this.drawHook.bind(this)],\n        processOffset: [this.processOffsetHook.bind(this)],\n      },\n      legend: {\n        show: true, // disable/enable legend\n      },\n      series: {\n        lines: {\n          show: this.panel.lines,\n          zero: false,\n          lineWidth: this.panel.linewidth,\n          fill: this.translateFillOption(this.panel.fill)\n        },\n        points: {\n          show: this.panel.points,\n          fill: 1,\n          fillColor: false,\n          radius: this.panel.points ? this.panel.pointradius : 2\n        },\n        shadowSize: 0\n      },\n      yaxes: [],\n      xaxis: {},\n      grid: {\n        minBorderMargin: 0,\n        markings: [],\n        backgroundColor: null,\n        borderWidth: 0,\n        hoverable: true,\n        clickable: true,\n        color: '#c8c8c8',\n        margin: { left: 0, right: 0 },\n      },\n      crosshair: {\n        mode: 'x'\n      },\n    };\n\n    this.addXAxis(options);\n    this.addYAxes(options);\n\n    // Make plot\n    $('#' + this.panelId).plot(this.plotdata.data, options);\n    // Hover event handler\n    $('#' + this.panelId).bind('plothover', _.throttle(this.createPlotHoverHandler(), 50));\n    // Manually apply theme css\n    this.styleTheme();\n\n    this.renderingCompleted();\n  }\n\n  onDataReceived(dataList) {\n    //console.log('received', dataList);\n    this.plotdata.data = [];\n    this.plotdata.timestamps = {};\n    this.plotdata.xlabel = null;\n\n    if (!dataList || dataList.length < 2) {\n      //console.log( \"No data\", dataList );\n    } else {\n      // First series in dataList is always x-axis data\n      this.plotdata.xlabel = dataList[0].target;\n\n      // Make all y data series and timestamp lists\n      dataList.slice(1).forEach(d => {\n        const xy = [];\n        const ts = [];\n        let maxy = -Number.MAX_VALUE;\n        let logminy = Number.MAX_VALUE;\n        d.datapoints.forEach((val, j) => {\n          if (_.isFinite(dataList[0].datapoints[j][0])) {\n            // Only keep values with defined x, but keep null y to create\n            // discontinuous segments\n            xy.push([dataList[0].datapoints[j][0], val[0]]);\n            ts.push(val[1]);  // time for hover tooltip\n            if (val[0] > maxy) maxy = val[0];\n            if (val[0] < logminy && val[0] > 0) logminy = val[0];\n          }\n        });\n        if (maxy === -Number.MAX_VALUE) maxy = null;\n        if (logminy === Number.MAX_VALUE) logminy = null;\n        this.plotdata.data.push({\n          label: d.target,\n          data: xy,\n          yaxis: 1,\n          stats: {\n            max: maxy,\n            logmin: logminy\n          }\n        });\n        this.plotdata.timestamps[d.target] = ts;\n      });\n\n      //console.log('DATA: ', this.plotdata);\n    }\n\n    this.render();\n  }\n\n  createPlotHoverHandler(event, pos, item) {\n    return (event, pos, item) => {\n      if (item) {\n        const ts = this.plotdata.timestamps[item.series.label][item.dataIndex];\n        const y = { label: item.series.label, value: item.datapoint[1] };\n        const x = { label: this.plotdata.xlabel, value: item.datapoint[0] };\n\n        var body = '<div class=\"graph-tooltip-time\">'+ this.dashboard.formatDate(moment(ts)) +'</div>';\n        body += \"<center>\";\n        body += '<div class=\"graph-tooltip-list-item\">';\n        body += '<div class=\"graph-tooltip-series-name\"><i class=\"fa fa-minus\" style=\"color:' + item.series.color + ';\"></i> ' + x.label + ' (x): </div>';\n        body += '<div class=\"graph-tooltip-value\">' + x.value.toPrecision(4) + '</div>';\n        body += '</div>'\n        body += '<div class=\"graph-tooltip-list-item\">';\n        body += '<div class=\"graph-tooltip-series-name\"><i class=\"fa fa-minus\" style=\"color:' + item.series.color + ';\"></i> ' + y.label + ' (y): </div>';\n        body += '<div class=\"graph-tooltip-value\">' + y.value.toPrecision(4) + '</div>';\n        body += '</div>'\n        body += \"</center>\";\n\n        this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n      } else {\n        this.$tooltip.detach();\n      }\n    };\n  }\n\n  translateFillOption(fill) {\n    return fill === 0 ? 0.001 : fill/10;\n  }\n\n  addXAxis(options) {\n    options.xaxis = {\n      show: this.panel.xaxis.show,\n      min: this.panel.xaxis.min ? _.toNumber(this.panel.xaxis.min) : null,\n      max: this.panel.xaxis.max ? _.toNumber(this.panel.xaxis.max) : null,\n      label: this.panel.xaxis.label\n    };\n  }\n\n  addYAxes(options) {\n    const defaults = {\n      position: 'left',\n      show: this.panel.yaxes[0].show,\n      index: 1,\n      logBase: this.panel.yaxes[0].logBase || 1,\n      min: this.panel.yaxes[0].min ? _.toNumber(this.panel.yaxes[0].min) : null,\n      max: this.panel.yaxes[0].max ? _.toNumber(this.panel.yaxes[0].max) : null,\n    };\n    options.yaxes.push(defaults);\n\n    if (_.find(this.plotdata.data, {yaxis: 2})) {\n      var secondY = _.clone(defaults);\n      secondY.index = 2;\n      secondY.show = this.panel.yaxes[1].show;\n      secondY.logBase = this.panel.yaxes[1].logBase || 1;\n      secondY.position = 'right';\n      secondY.min = this.panel.yaxes[1].min ? _.toNumber(this.panel.yaxes[1].min) : null;\n      secondY.max = this.panel.yaxes[1].max ? _.toNumber(this.panel.yaxes[1].max) : null;\n      options.yaxes.push(secondY);\n\n      this.applyLogScale(options.yaxes[1], this.plotdata.data);\n      //configureAxisMode(options.yaxes[1], panel.percentage && panel.stack ? \"percent\" : panel.yaxes[1].format);\n    }\n    this.applyLogScale(options.yaxes[0], this.plotdata.data);\n    this.configureAxisMode(options.yaxes[0], this.panel.yaxes[0].format);\n  }\n\n  applyLogScale(axis, data) {\n    if (axis.logBase === 1) {\n      return;\n    }\n    if (axis.min < Number.MIN_VALUE) {\n      axis.min = null;\n    }\n    if (axis.max < Number.MIN_VALUE) {\n      axis.max = null;\n    }\n\n    var series, i;\n    var max = axis.max, min = axis.min;\n\n    for (i = 0; i < data.length; i++) {\n      series = data[i];\n      if (series.yaxis === axis.index) {\n        if (!max || max < series.stats.max) {\n          max = series.stats.max;\n        }\n        if (!min || min > series.stats.logmin) {\n          min = series.stats.logmin;\n        }\n      }\n    }\n\n    axis.transform = function(v) { return (v < Number.MIN_VALUE) ? null : Math.log(v) / Math.log(axis.logBase); };\n    axis.inverseTransform  = function (v) { return Math.pow(axis.logBase,v); };\n\n    if (!max && !min) {\n      max = axis.inverseTransform(+2);\n      min = axis.inverseTransform(-2);\n    } else if (!max) {\n      max = min*axis.inverseTransform(+4);\n    } else if (!min) {\n      min = max*axis.inverseTransform(-4);\n    }\n\n    if (axis.min) {\n      min = axis.inverseTransform(Math.ceil(axis.transform(axis.min)));\n    } else {\n      min = axis.min = axis.inverseTransform(Math.floor(axis.transform(min)));\n    }\n    if (axis.max) {\n      max = axis.inverseTransform(Math.floor(axis.transform(axis.max)));\n    } else {\n      max = axis.max = axis.inverseTransform(Math.ceil(axis.transform(max)));\n    }\n\n    if (!min || min < Number.MIN_VALUE || !max || max < Number.MIN_VALUE) {\n      return;\n    }\n\n    axis.ticks = [];\n    var nextTick;\n    for (nextTick = min; nextTick <= max; nextTick *= axis.logBase) {\n      axis.ticks.push(nextTick);\n    }\n    axis.tickDecimals = this.decimalPlaces(min);\n  }\n\n  decimalPlaces(num) {\n    if (!num) { return 0; }\n\n    return (num.toString().split('.')[1] || []).length;\n  }\n\n  configureAxisMode(axis, format) {\n    axis.tickFormatter = function(val, axis) {\n      return kbn.valueFormats[format](val, axis.tickDecimals, axis.scaledDecimals);\n    };\n  }\n\n  setUnitFormat(axis, subItem) {\n    axis.format = subItem.value;\n    this.render();\n  }\n\n  drawHook(plot) {\n    // Update legend values\n    var yaxis = plot.getYAxes();\n    for (var i = 0; i < this.plotdata.data.length; i++) {\n      var series = this.plotdata.data[i];\n      var axis = yaxis[series.yaxis - 1];\n      var formater = kbn.valueFormats[this.panel.yaxes[series.yaxis - 1].format];\n\n      // decimal override\n      if (_.isNumber(this.panel.decimals)) {\n        //series.updateLegendValues(formater, this.panel.decimals, null);\n      } else {\n        // auto decimals\n        // legend and tooltip gets one more decimal precision\n        // than graph legend ticks\n        var tickDecimals = (axis.tickDecimals || -1) + 1;\n        //series.updateLegendValues(formater, tickDecimals, axis.scaledDecimals + 2);\n      }\n\n      if (!this.$rootScope.$$phase) { this.$scope.$digest(); }\n    }\n\n    // add left axis labels\n    if (this.panel.yaxes[0].label) {\n      var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label flot-temp-elem'></div>\")\n      .text(this.panel.yaxes[0].label)\n      .appendTo($('#' + this.panelId));\n    }\n\n    // add right axis labels\n    /*if (this.panel.yaxes[1].label) {\n      var rightLabel = $(\"<div class='axisLabel right-yaxis-label flot-temp-elem'></div>\")\n      .text(this.panel.yaxes[1].label)\n      .appendTo($('#' + this.panelId));\n    }*/\n\n    this.thresholdManager.draw(plot);\n  }\n\n  processOffsetHook(plot, gridMargin) {\n    var left = this.panel.yaxes[0];\n    //var right = this.panel.yaxes[1];\n    if (left.show && left.label) { gridMargin.left = 20; }\n    //if (right.show && right.label) { gridMargin.right = 20; }\n\n    // apply y-axis min/max options\n    var yaxis = plot.getYAxes();\n    //for (var i = 0; i < yaxis.length; i++) {\n    var axis = yaxis[0];\n    var panelOptions = this.panel.yaxes[0];\n    axis.options.max = panelOptions.max;\n    axis.options.min = panelOptions.min;\n    //}\n  }\n\n  styleTheme() {\n    if (config.bootData.user.lightTheme) {\n      $('.legend > div').css('background-color', 'rgb(255,255,255)');\n    } else {\n      $('.legend > div').css('background-color', 'rgb(25,25,25)');\n    }\n  }\n}\nTwoDPanelCtrl.templateUrl = 'module.html';\n\nexport {\n  TwoDPanelCtrl as PanelCtrl\n};\n"]}