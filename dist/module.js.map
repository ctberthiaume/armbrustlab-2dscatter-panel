{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","ThresholdManager","kbn","_","moment","panelDefaults","lines","linewidth","fill","points","pointradius","xaxis","show","yaxes","logBase","format","range","from","to","TwoDPanelCtrl","$scope","$injector","$q","$rootScope","panelId","panel","id","thresholdManager","defaults","plotdata","data","xlabel","timestamps","logScales","unitFormats","getUnitFormats","$tooltip","$","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","onPanelTeardown","err","empty","addEditorTab","subTabIndex","length","options","hooks","draw","drawHook","processOffset","processOffsetHook","legend","series","zero","lineWidth","translateFillOption","fillColor","radius","shadowSize","grid","minBorderMargin","markings","backgroundColor","borderWidth","hoverable","clickable","color","margin","left","right","crosshair","mode","addXAxis","addYAxes","plot","throttle","createPlotHoverHandler","renderingCompleted","dataList","target","slice","forEach","xy","ts","maxy","Number","MAX_VALUE","logminy","d","datapoints","val","j","isFinite","push","label","yaxis","stats","max","logmin","render","event","pos","item","dataIndex","y","value","datapoint","x","body","dashboard","formatDate","toPrecision","html","place_tt","pageX","pageY","detach","min","toNumber","position","index","find","secondY","clone","applyLogScale","configureAxisMode","axis","MIN_VALUE","i","transform","v","Math","log","inverseTransform","pow","ceil","floor","ticks","nextTick","tickDecimals","decimalPlaces","num","toString","split","tickFormatter","valueFormats","scaledDecimals","subItem","getYAxes","formater","isNumber","decimals","$$phase","$digest","yaxisLabel","text","appendTo","gridMargin","panelOptions","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACQA,sB,kBAAAA,gB;;AACAC,sB,0CAAAA,gB;;AACDC,S;;AAEAC,O;;AACAC,Y;;;;;;;;;;;;;;;;;;;;;AAIDC,mB,GAAgB;AACpBC,eAAO,IADa;AAEpBC,mBAAW,CAFS;AAGpBC,cAAM,CAHc;AAIpBC,gBAAQ,KAJY;AAKpBC,qBAAa,CALO;AAMpBC,eAAO;AACLC,gBAAM;AADD,SANa;AASpBC,eAAO,CACL;AACED,gBAAM,IADR;AAEEE,mBAAS,CAFX;AAGEC,kBAAQ;AAHV,SADK,CATa;AAqBpBC,eAAO;AACLC,gBAAM,IADD;AAELC,cAAI;AAFC;AArBa,O;;2BA2BhBC,a;;;AACJ,+BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,EAA/B,EAAmCC,UAAnC,EAA+C;AAAA;;AAAA,oIACvCH,MADuC,EAC/BC,SAD+B;;AAE7C,gBAAKD,MAAL,GAAcA,MAAd;AACA,gBAAKG,UAAL,GAAkBA,UAAlB;AACA,gBAAKC,OAAL,GAAe,SAAS,MAAKC,KAAL,CAAWC,EAAnC;;AAEA,gBAAKC,gBAAL,GAAwB,IAAI1B,gBAAJ,OAAxB;;AAEA,gBAAKwB,KAAL,GAAatB,EAAEyB,QAAF,CAAW,MAAKH,KAAhB,EAAuBpB,aAAvB,CAAb;;AAEA,gBAAKwB,QAAL,GAAgB;AACdC,kBAAM,EADQ;AAEdC,oBAAQ,IAFM;AAGdC,wBAAY;AAHE,WAAhB;;AAMA,gBAAKC,SAAL,GAAiB;AACf,sBAAU,CADK;AAEf,4BAAgB,CAFD;AAGf,6BAAiB,EAHF;AAIf,6BAAiB,EAJF;AAKf,+BAAmB;AALJ,WAAjB;;AAQA,gBAAKC,WAAL,GAAmBhC,IAAIiC,cAAJ,EAAnB;;AAEA,gBAAKC,QAAL,GAAgBC,EAAE,6BAAF,CAAhB;;AAEA,gBAAKC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKG,QAAL,CAAcD,IAAd,OAAzB;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKI,cAAL,CAAoBF,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKK,WAAL,CAAiBH,IAAjB,OAA7B;AACA;AACA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKM,eAAL,CAAqBJ,IAArB,OAAjC;AAlC6C;AAmC9C;;;;sCAEWK,G,EAAK;AACf;AACAT,cAAE,MAAM,KAAKb,OAAb,EAAsBuB,KAAtB;AACA,iBAAKlB,QAAL,CAAcC,IAAd,GAAqB,EAArB;AACA,iBAAKD,QAAL,CAAcG,UAAd,GAA2B,EAA3B;AACA,iBAAKH,QAAL,CAAcE,MAAd,GAAuB,IAAvB;AACD;;;+CAEoB;AACnB;AACD;;;4CAEiB;AAChB;AACAM,cAAE,MAAM,KAAKb,OAAb,EAAsBuB,KAAtB;AACD;;;sCAEW;AACV;AACD;;;2CAEgB;AACf,iBAAKC,YAAL,CAAkB,MAAlB,EAA0B,wDAA1B,EAAoF,CAApF;AACA,iBAAKA,YAAL,CAAkB,SAAlB,EAA6B,wDAA7B,EAAuF,CAAvF;AACA,iBAAKC,WAAL,GAAmB,CAAnB;AACD;;;qCAEU;AACT;AACAZ,cAAE,MAAM,KAAKb,OAAb,EAAsBuB,KAAtB;;AAEA,gBAAI,KAAKlB,QAAL,CAAcC,IAAd,CAAmBoB,MAAnB,KAA8B,CAAlC,EAAqC;AACnC;AACD;;AAED,gBAAMC,UAAU;AACdC,qBAAO;AACLC,sBAAM,CAAC,KAAKC,QAAL,CAAcb,IAAd,CAAmB,IAAnB,CAAD,CADD;AAELc,+BAAe,CAAC,KAAKC,iBAAL,CAAuBf,IAAvB,CAA4B,IAA5B,CAAD;AAFV,eADO;AAKdgB,sBAAQ;AACN7C,sBAAM,IADA,EALM;AAQd8C,sBAAQ;AACNpD,uBAAO;AACLM,wBAAM,KAAKa,KAAL,CAAWnB,KADZ;AAELqD,wBAAM,KAFD;AAGLC,6BAAW,KAAKnC,KAAL,CAAWlB,SAHjB;AAILC,wBAAM,KAAKqD,mBAAL,CAAyB,KAAKpC,KAAL,CAAWjB,IAApC;AAJD,iBADD;AAONC,wBAAQ;AACNG,wBAAM,KAAKa,KAAL,CAAWhB,MADX;AAEND,wBAAM,CAFA;AAGNsD,6BAAW,KAHL;AAINC,0BAAQ,KAAKtC,KAAL,CAAWhB,MAAX,GAAoB,KAAKgB,KAAL,CAAWf,WAA/B,GAA6C;AAJ/C,iBAPF;AAaNsD,4BAAY;AAbN,eARM;AAuBdnD,qBAAO,EAvBO;AAwBdF,qBAAO,EAxBO;AAyBdsD,oBAAM;AACJC,iCAAiB,CADb;AAEJC,0BAAU,EAFN;AAGJC,iCAAiB,IAHb;AAIJC,6BAAa,CAJT;AAKJC,2BAAW,IALP;AAMJC,2BAAW,IANP;AAOJC,uBAAO,SAPH;AAQJC,wBAAQ,EAAEC,MAAM,CAAR,EAAWC,OAAO,CAAlB;AARJ,eAzBQ;AAmCdC,yBAAW;AACTC,sBAAM;AADG;AAnCG,aAAhB;;AAwCA,iBAAKC,QAAL,CAAc3B,OAAd;AACA,iBAAK4B,QAAL,CAAc5B,OAAd;;AAEA;AACAd,cAAE,MAAM,KAAKb,OAAb,EAAsBwD,IAAtB,CAA2B,KAAKnD,QAAL,CAAcC,IAAzC,EAA+CqB,OAA/C;AACA;AACAd,cAAE,MAAM,KAAKb,OAAb,EAAsBiB,IAAtB,CAA2B,WAA3B,EAAwCtC,EAAE8E,QAAF,CAAW,KAAKC,sBAAL,EAAX,EAA0C,EAA1C,CAAxC;AACA,iBAAKC,kBAAL;AACD;;;yCAEcC,Q,EAAU;AAAA;;AACvB;AACA,iBAAKvD,QAAL,CAAcC,IAAd,GAAqB,EAArB;AACA,iBAAKD,QAAL,CAAcG,UAAd,GAA2B,EAA3B;AACA,iBAAKH,QAAL,CAAcE,MAAd,GAAuB,IAAvB;;AAEA,gBAAI,CAACqD,QAAD,IAAaA,SAASlC,MAAT,GAAkB,CAAnC,EAAsC;AACpC;AACD,aAFD,MAEO;AACL;AACA,mBAAKrB,QAAL,CAAcE,MAAd,GAAuBqD,SAAS,CAAT,EAAYC,MAAnC;;AAEA;AACAD,uBAASE,KAAT,CAAe,CAAf,EAAkBC,OAAlB,CAA0B,aAAK;AAC7B,oBAAMC,KAAK,EAAX;AACA,oBAAMC,KAAK,EAAX;AACA,oBAAIC,OAAO,CAACC,OAAOC,SAAnB;AACA,oBAAIC,UAAUF,OAAOC,SAArB;AACAE,kBAAEC,UAAF,CAAaR,OAAb,CAAqB,UAACS,GAAD,EAAMC,CAAN,EAAY;AAC/B,sBAAI9F,EAAE+F,QAAF,CAAWd,SAAS,CAAT,EAAYW,UAAZ,CAAuBE,CAAvB,EAA0B,CAA1B,CAAX,CAAJ,EAA8C;AAC5C;AACA;AACAT,uBAAGW,IAAH,CAAQ,CAACf,SAAS,CAAT,EAAYW,UAAZ,CAAuBE,CAAvB,EAA0B,CAA1B,CAAD,EAA+BD,IAAI,CAAJ,CAA/B,CAAR;AACAP,uBAAGU,IAAH,CAAQH,IAAI,CAAJ,CAAR,EAJ4C,CAI1B;AAClB,wBAAIA,IAAI,CAAJ,IAASN,IAAb,EAAmBA,OAAOM,IAAI,CAAJ,CAAP;AACnB,wBAAIA,IAAI,CAAJ,IAASH,OAAT,IAAoBG,IAAI,CAAJ,IAAS,CAAjC,EAAoCH,UAAUG,IAAI,CAAJ,CAAV;AACrC;AACF,iBATD;AAUA,oBAAIN,SAAS,CAACC,OAAOC,SAArB,EAAgCF,OAAO,IAAP;AAChC,oBAAIG,YAAYF,OAAOC,SAAvB,EAAkCC,UAAU,IAAV;AAClC,uBAAKhE,QAAL,CAAcC,IAAd,CAAmBqE,IAAnB,CAAwB;AACtBC,yBAAON,EAAET,MADa;AAEtBvD,wBAAM0D,EAFgB;AAGtBa,yBAAO,CAHe;AAItBC,yBAAO;AACLC,yBAAKb,IADA;AAELc,4BAAQX;AAFH;AAJe,iBAAxB;AASA,uBAAKhE,QAAL,CAAcG,UAAd,CAAyB8D,EAAET,MAA3B,IAAqCI,EAArC;AACD,eA3BD;;AA6BA;AACD;;AAED,iBAAKgB,MAAL;AACD;;;iDAEsBC,K,EAAOC,G,EAAKC,I,EAAM;AAAA;;AACvC,mBAAO,UAACF,KAAD,EAAQC,GAAR,EAAaC,IAAb,EAAsB;AAC3B,kBAAIA,IAAJ,EAAU;AACR,oBAAMnB,KAAK,OAAK5D,QAAL,CAAcG,UAAd,CAAyB4E,KAAKlD,MAAL,CAAY0C,KAArC,EAA4CQ,KAAKC,SAAjD,CAAX;AACA,oBAAMC,IAAI,EAAEV,OAAOQ,KAAKlD,MAAL,CAAY0C,KAArB,EAA4BW,OAAOH,KAAKI,SAAL,CAAe,CAAf,CAAnC,EAAV;AACA,oBAAMC,IAAI,EAAEb,OAAO,OAAKvE,QAAL,CAAcE,MAAvB,EAA+BgF,OAAOH,KAAKI,SAAL,CAAe,CAAf,CAAtC,EAAV;;AAEA,oBAAIE,OAAO,qCAAoC,OAAKC,SAAL,CAAeC,UAAf,CAA0BhH,OAAOqF,EAAP,CAA1B,CAApC,GAA2E,QAAtF;AACAyB,wBAAQ,UAAR;AACAA,wBAAQ,uCAAR;AACAA,wBAAQ,gFAAgFN,KAAKlD,MAAL,CAAYc,KAA5F,GAAoG,UAApG,GAAiHyC,EAAEb,KAAnH,GAA2H,cAAnI;AACAc,wBAAQ,sCAAsCD,EAAEF,KAAF,CAAQM,WAAR,CAAoB,CAApB,CAAtC,GAA+D,QAAvE;AACAH,wBAAQ,QAAR;AACAA,wBAAQ,uCAAR;AACAA,wBAAQ,gFAAgFN,KAAKlD,MAAL,CAAYc,KAA5F,GAAoG,UAApG,GAAiHsC,EAAEV,KAAnH,GAA2H,cAAnI;AACAc,wBAAQ,sCAAsCJ,EAAEC,KAAF,CAAQM,WAAR,CAAoB,CAApB,CAAtC,GAA+D,QAAvE;AACAH,wBAAQ,QAAR;AACAA,wBAAQ,WAAR;;AAEA,uBAAK9E,QAAL,CAAckF,IAAd,CAAmBJ,IAAnB,EAAyBK,QAAzB,CAAkCZ,IAAIa,KAAJ,GAAY,EAA9C,EAAkDb,IAAIc,KAAtD;AACD,eAlBD,MAkBO;AACL,uBAAKrF,QAAL,CAAcsF,MAAd;AACD;AACF,aAtBD;AAuBD;;;8CAEmBlH,I,EAAM;AACxB,mBAAOA,SAAS,CAAT,GAAa,KAAb,GAAqBA,OAAK,EAAjC;AACD;;;mCAEQ2C,O,EAAS;AAChBA,oBAAQxC,KAAR,GAAgB;AACdC,oBAAM,KAAKa,KAAL,CAAWd,KAAX,CAAiBC,IADT;AAEd+G,mBAAK,KAAKlG,KAAL,CAAWd,KAAX,CAAiBgH,GAAjB,GAAuBxH,EAAEyH,QAAF,CAAW,KAAKnG,KAAL,CAAWd,KAAX,CAAiBgH,GAA5B,CAAvB,GAA0D,IAFjD;AAGdpB,mBAAK,KAAK9E,KAAL,CAAWd,KAAX,CAAiB4F,GAAjB,GAAuBpG,EAAEyH,QAAF,CAAW,KAAKnG,KAAL,CAAWd,KAAX,CAAiB4F,GAA5B,CAAvB,GAA0D,IAHjD;AAIdH,qBAAO,KAAK3E,KAAL,CAAWd,KAAX,CAAiByF;AAJV,aAAhB;AAMD;;;mCAEQjD,O,EAAS;AAChB,gBAAMvB,WAAW;AACfiG,wBAAU,MADK;AAEfjH,oBAAM,KAAKa,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBD,IAFX;AAGfkH,qBAAO,CAHQ;AAIfhH,uBAAS,KAAKW,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBC,OAApB,IAA+B,CAJzB;AAKf6G,mBAAK,KAAKlG,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB8G,GAApB,GAA0BxH,EAAEyH,QAAF,CAAW,KAAKnG,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB8G,GAA/B,CAA1B,GAAgE,IALtD;AAMfpB,mBAAK,KAAK9E,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB0F,GAApB,GAA0BpG,EAAEyH,QAAF,CAAW,KAAKnG,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB0F,GAA/B,CAA1B,GAAgE;AANtD,aAAjB;;AASApD,oBAAQtC,KAAR,CAAcsF,IAAd,CAAmBvE,QAAnB;;AAEA,gBAAIzB,EAAE4H,IAAF,CAAO,KAAKlG,QAAL,CAAcC,IAArB,EAA2B,EAACuE,OAAO,CAAR,EAA3B,CAAJ,EAA4C;AAC1C,kBAAI2B,UAAU7H,EAAE8H,KAAF,CAAQrG,QAAR,CAAd;AACAoG,sBAAQF,KAAR,GAAgB,CAAhB;AACAE,sBAAQpH,IAAR,GAAe,KAAKa,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBD,IAAnC;AACAoH,sBAAQlH,OAAR,GAAkB,KAAKW,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBC,OAApB,IAA+B,CAAjD;AACAkH,sBAAQH,QAAR,GAAmB,OAAnB;AACAG,sBAAQL,GAAR,GAAc,KAAKlG,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB8G,GAApB,GAA0BxH,EAAEyH,QAAF,CAAW,KAAKnG,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB8G,GAA/B,CAA1B,GAAgE,IAA9E;AACAK,sBAAQzB,GAAR,GAAc,KAAK9E,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB0F,GAApB,GAA0BpG,EAAEyH,QAAF,CAAW,KAAKnG,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoB0F,GAA/B,CAA1B,GAAgE,IAA9E;AACApD,sBAAQtC,KAAR,CAAcsF,IAAd,CAAmB6B,OAAnB;;AAEA,mBAAKE,aAAL,CAAmB/E,QAAQtC,KAAR,CAAc,CAAd,CAAnB,EAAqC,KAAKgB,QAAL,CAAcC,IAAnD;AACA;AACD;AACD,iBAAKoG,aAAL,CAAmB/E,QAAQtC,KAAR,CAAc,CAAd,CAAnB,EAAqC,KAAKgB,QAAL,CAAcC,IAAnD;AACA,iBAAKqG,iBAAL,CAAuBhF,QAAQtC,KAAR,CAAc,CAAd,CAAvB,EAAyC,KAAKY,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBE,MAA7D;AACD;;;wCAEaqH,I,EAAMtG,I,EAAM;AACxB,gBAAIsG,KAAKtH,OAAL,KAAiB,CAArB,EAAwB;AACtB;AACD;AACD,gBAAIsH,KAAKT,GAAL,GAAWhC,OAAO0C,SAAtB,EAAiC;AAC/BD,mBAAKT,GAAL,GAAW,IAAX;AACD;AACD,gBAAIS,KAAK7B,GAAL,GAAWZ,OAAO0C,SAAtB,EAAiC;AAC/BD,mBAAK7B,GAAL,GAAW,IAAX;AACD;;AAED,gBAAI7C,MAAJ,EAAY4E,CAAZ;AACA,gBAAI/B,MAAM6B,KAAK7B,GAAf;AAAA,gBAAoBoB,MAAMS,KAAKT,GAA/B;;AAEA,iBAAKW,IAAI,CAAT,EAAYA,IAAIxG,KAAKoB,MAArB,EAA6BoF,GAA7B,EAAkC;AAChC5E,uBAAS5B,KAAKwG,CAAL,CAAT;AACA,kBAAI5E,OAAO2C,KAAP,KAAiB+B,KAAKN,KAA1B,EAAiC;AAC/B,oBAAI,CAACvB,GAAD,IAAQA,MAAM7C,OAAO4C,KAAP,CAAaC,GAA/B,EAAoC;AAClCA,wBAAM7C,OAAO4C,KAAP,CAAaC,GAAnB;AACD;AACD,oBAAI,CAACoB,GAAD,IAAQA,MAAMjE,OAAO4C,KAAP,CAAaE,MAA/B,EAAuC;AACrCmB,wBAAMjE,OAAO4C,KAAP,CAAaE,MAAnB;AACD;AACF;AACF;;AAED4B,iBAAKG,SAAL,GAAiB,UAASC,CAAT,EAAY;AAAE,qBAAQA,IAAI7C,OAAO0C,SAAZ,GAAyB,IAAzB,GAAgCI,KAAKC,GAAL,CAASF,CAAT,IAAcC,KAAKC,GAAL,CAASN,KAAKtH,OAAd,CAArD;AAA8E,aAA7G;AACAsH,iBAAKO,gBAAL,GAAyB,UAAUH,CAAV,EAAa;AAAE,qBAAOC,KAAKG,GAAL,CAASR,KAAKtH,OAAd,EAAsB0H,CAAtB,CAAP;AAAkC,aAA1E;;AAEA,gBAAI,CAACjC,GAAD,IAAQ,CAACoB,GAAb,EAAkB;AAChBpB,oBAAM6B,KAAKO,gBAAL,CAAsB,CAAC,CAAvB,CAAN;AACAhB,oBAAMS,KAAKO,gBAAL,CAAsB,CAAC,CAAvB,CAAN;AACD,aAHD,MAGO,IAAI,CAACpC,GAAL,EAAU;AACfA,oBAAMoB,MAAIS,KAAKO,gBAAL,CAAsB,CAAC,CAAvB,CAAV;AACD,aAFM,MAEA,IAAI,CAAChB,GAAL,EAAU;AACfA,oBAAMpB,MAAI6B,KAAKO,gBAAL,CAAsB,CAAC,CAAvB,CAAV;AACD;;AAED,gBAAIP,KAAKT,GAAT,EAAc;AACZA,oBAAMS,KAAKO,gBAAL,CAAsBF,KAAKI,IAAL,CAAUT,KAAKG,SAAL,CAAeH,KAAKT,GAApB,CAAV,CAAtB,CAAN;AACD,aAFD,MAEO;AACLA,oBAAMS,KAAKT,GAAL,GAAWS,KAAKO,gBAAL,CAAsBF,KAAKK,KAAL,CAAWV,KAAKG,SAAL,CAAeZ,GAAf,CAAX,CAAtB,CAAjB;AACD;AACD,gBAAIS,KAAK7B,GAAT,EAAc;AACZA,oBAAM6B,KAAKO,gBAAL,CAAsBF,KAAKK,KAAL,CAAWV,KAAKG,SAAL,CAAeH,KAAK7B,GAApB,CAAX,CAAtB,CAAN;AACD,aAFD,MAEO;AACLA,oBAAM6B,KAAK7B,GAAL,GAAW6B,KAAKO,gBAAL,CAAsBF,KAAKI,IAAL,CAAUT,KAAKG,SAAL,CAAehC,GAAf,CAAV,CAAtB,CAAjB;AACD;;AAED,gBAAI,CAACoB,GAAD,IAAQA,MAAMhC,OAAO0C,SAArB,IAAkC,CAAC9B,GAAnC,IAA0CA,MAAMZ,OAAO0C,SAA3D,EAAsE;AACpE;AACD;;AAEDD,iBAAKW,KAAL,GAAa,EAAb;AACA,gBAAIC,QAAJ;AACA,iBAAKA,WAAWrB,GAAhB,EAAqBqB,YAAYzC,GAAjC,EAAsCyC,YAAYZ,KAAKtH,OAAvD,EAAgE;AAC9DsH,mBAAKW,KAAL,CAAW5C,IAAX,CAAgB6C,QAAhB;AACD;AACDZ,iBAAKa,YAAL,GAAoB,KAAKC,aAAL,CAAmBvB,GAAnB,CAApB;AACD;;;wCAEawB,G,EAAK;AACjB,gBAAI,CAACA,GAAL,EAAU;AAAE,qBAAO,CAAP;AAAW;;AAEvB,mBAAO,CAACA,IAAIC,QAAJ,GAAeC,KAAf,CAAqB,GAArB,EAA0B,CAA1B,KAAgC,EAAjC,EAAqCnG,MAA5C;AACD;;;4CAEiBkF,I,EAAMrH,M,EAAQ;AAC9BqH,iBAAKkB,aAAL,GAAqB,UAAStD,GAAT,EAAcoC,IAAd,EAAoB;AACvC,qBAAOlI,IAAIqJ,YAAJ,CAAiBxI,MAAjB,EAAyBiF,GAAzB,EAA8BoC,KAAKa,YAAnC,EAAiDb,KAAKoB,cAAtD,CAAP;AACD,aAFD;AAGD;;;wCAEapB,I,EAAMqB,O,EAAS;AAC3BrB,iBAAKrH,MAAL,GAAc0I,QAAQ1C,KAAtB;AACA,iBAAKN,MAAL;AACD;;;mCAEQzB,I,EAAM;AACb;AACA,gBAAIqB,QAAQrB,KAAK0E,QAAL,EAAZ;AACA,iBAAK,IAAIpB,IAAI,CAAb,EAAgBA,IAAI,KAAKzG,QAAL,CAAcC,IAAd,CAAmBoB,MAAvC,EAA+CoF,GAA/C,EAAoD;AAClD,kBAAI5E,SAAS,KAAK7B,QAAL,CAAcC,IAAd,CAAmBwG,CAAnB,CAAb;AACA,kBAAIF,OAAO/B,MAAM3C,OAAO2C,KAAP,GAAe,CAArB,CAAX;AACA,kBAAIsD,WAAWzJ,IAAIqJ,YAAJ,CAAiB,KAAK9H,KAAL,CAAWZ,KAAX,CAAiB6C,OAAO2C,KAAP,GAAe,CAAhC,EAAmCtF,MAApD,CAAf;;AAEA;AACA,kBAAIZ,EAAEyJ,QAAF,CAAW,KAAKnI,KAAL,CAAWoI,QAAtB,CAAJ,EAAqC;AACnC;AACD,eAFD,MAEO;AACL;AACA;AACA;AACA,oBAAIZ,eAAe,CAACb,KAAKa,YAAL,IAAqB,CAAC,CAAvB,IAA4B,CAA/C;AACA;AACD;;AAED,kBAAI,CAAC,KAAK1H,UAAL,CAAgBuI,OAArB,EAA8B;AAAE,qBAAK1I,MAAL,CAAY2I,OAAZ;AAAwB;AACzD;;AAED;AACA,gBAAI,KAAKtI,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBuF,KAAxB,EAA+B;AAC7B,kBAAI4D,aAAa3H,EAAE,+DAAF,EAChB4H,IADgB,CACX,KAAKxI,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,EAAoBuF,KADT,EAEhB8D,QAFgB,CAEP7H,EAAE,MAAM,KAAKb,OAAb,CAFO,CAAjB;AAGD;;AAED;AACA;;;;;;AAMA,iBAAKG,gBAAL,CAAsB0B,IAAtB,CAA2B2B,IAA3B;AACD;;;4CAEiBA,I,EAAMmF,U,EAAY;AAClC,gBAAIzF,OAAO,KAAKjD,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,CAAX;AACA;AACA,gBAAI6D,KAAK9D,IAAL,IAAa8D,KAAK0B,KAAtB,EAA6B;AAAE+D,yBAAWzF,IAAX,GAAkB,EAAlB;AAAuB;AACtD;;AAEA;AACA,gBAAI2B,QAAQrB,KAAK0E,QAAL,EAAZ;AACA;AACA,gBAAItB,OAAO/B,MAAM,CAAN,CAAX;AACA,gBAAI+D,eAAe,KAAK3I,KAAL,CAAWZ,KAAX,CAAiB,CAAjB,CAAnB;AACAuH,iBAAKjF,OAAL,CAAaoD,GAAb,GAAmB6D,aAAa7D,GAAhC;AACA6B,iBAAKjF,OAAL,CAAawE,GAAb,GAAmByC,aAAazC,GAAhC;AACA;AACD;;;;QAlXyB3H,gB;;AAoX5BmB,oBAAckJ,WAAd,GAA4B,aAA5B;;2BAGElJ,a","file":"module.js","sourcesContent":["\nimport {MetricsPanelCtrl} from  'app/plugins/sdk';\nimport {ThresholdManager} from 'app/plugins/panel/graph/threshold_manager';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport moment from 'moment';\n\nimport './css/style.css!';\n\nconst panelDefaults = {\n  lines: true,\n  linewidth: 1,\n  fill: 1,\n  points: false,\n  pointradius: 5,\n  xaxis: {\n    show: true\n  },\n  yaxes: [\n    {\n      show: true,\n      logBase: 1,\n      format: 'short'\n    },\n    /*{\n      show: true,\n      logBase: 1,\n      format: 'short'\n    }*/\n  ],\n  range: {\n    from: null,\n    to: null\n  }\n};\n\nclass TwoDPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $q, $rootScope) {\n    super($scope, $injector);\n    this.$scope = $scope;\n    this.$rootScope = $rootScope;\n    this.panelId = 'twod' + this.panel.id;\n\n    this.thresholdManager = new ThresholdManager(this);\n\n    this.panel = _.defaults(this.panel, panelDefaults);\n\n    this.plotdata = {\n      data: [],\n      xlabel: null,\n      timestamps: {}\n    };\n\n    this.logScales = {\n      'linear': 1,\n      'log (base 2)': 2,\n      'log (base 10)': 10,\n      'log (base 32)': 32,\n      'log (base 1024)': 1024\n    };\n\n    this.unitFormats = kbn.getUnitFormats();\n\n    this.$tooltip = $('<div class=\"graph-tooltip\">');\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    //this.events.on('panel-initialized', this.onPanelInitialized.bind(this));\n    //this.events.on('refresh', this.onRefresh.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n  }\n\n  onDataError(err) {\n    //console.log(\"onDataError\", err);\n    $('#' + this.panelId).empty();\n    this.plotdata.data = [];\n    this.plotdata.timestamps = {};\n    this.plotdata.xlabel = null;\n  }\n\n  onPanelInitialized() {\n    //console.log('initialized');\n  }\n\n  onPanelTeardown() {\n    //console.log('teardown');\n    $('#' + this.panelId).empty();\n  }\n\n  onRefresh() {\n    //console.log('refresh');\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Axes', 'public/plugins/armbrustlab-twod-panel/axes_editor.html', 2);\n    this.addEditorTab('Display', 'public/plugins/armbrustlab-twod-panel/tab_display.html', 3);\n    this.subTabIndex = 0;\n  }\n\n  onRender() {\n    //console.log('flot ' + this.panel.id + ' render');\n    $('#' + this.panelId).empty();\n\n    if (this.plotdata.data.length === 0) {\n      return;\n    }\n\n    const options = {\n      hooks: {\n        draw: [this.drawHook.bind(this)],\n        processOffset: [this.processOffsetHook.bind(this)],\n      },\n      legend: {\n        show: true, // disable/enable legend\n      },\n      series: {\n        lines: {\n          show: this.panel.lines,\n          zero: false,\n          lineWidth: this.panel.linewidth,\n          fill: this.translateFillOption(this.panel.fill)\n        },\n        points: {\n          show: this.panel.points,\n          fill: 1,\n          fillColor: false,\n          radius: this.panel.points ? this.panel.pointradius : 2\n        },\n        shadowSize: 0\n      },\n      yaxes: [],\n      xaxis: {},\n      grid: {\n        minBorderMargin: 0,\n        markings: [],\n        backgroundColor: null,\n        borderWidth: 0,\n        hoverable: true,\n        clickable: true,\n        color: '#c8c8c8',\n        margin: { left: 0, right: 0 },\n      },\n      crosshair: {\n        mode: 'x'\n      },\n    };\n\n    this.addXAxis(options);\n    this.addYAxes(options);\n\n    // Make plot\n    $('#' + this.panelId).plot(this.plotdata.data, options);\n    // Hover event handler\n    $('#' + this.panelId).bind('plothover', _.throttle(this.createPlotHoverHandler(), 50));\n    this.renderingCompleted();\n  }\n\n  onDataReceived(dataList) {\n    //console.log('received', dataList);\n    this.plotdata.data = [];\n    this.plotdata.timestamps = {};\n    this.plotdata.xlabel = null;\n\n    if (!dataList || dataList.length < 2) {\n      //console.log( \"No data\", dataList );\n    } else {\n      // First series in dataList is always x-axis data\n      this.plotdata.xlabel = dataList[0].target;\n\n      // Make all y data series and timestamp lists\n      dataList.slice(1).forEach(d => {\n        const xy = [];\n        const ts = [];\n        let maxy = -Number.MAX_VALUE;\n        let logminy = Number.MAX_VALUE;\n        d.datapoints.forEach((val, j) => {\n          if (_.isFinite(dataList[0].datapoints[j][0])) {\n            // Only keep values with defined x, but keep null y to create\n            // discontinuous segments\n            xy.push([dataList[0].datapoints[j][0], val[0]]);\n            ts.push(val[1]);  // time for hover tooltip\n            if (val[0] > maxy) maxy = val[0];\n            if (val[0] < logminy && val[0] > 0) logminy = val[0];\n          }\n        });\n        if (maxy === -Number.MAX_VALUE) maxy = null;\n        if (logminy === Number.MAX_VALUE) logminy = null;\n        this.plotdata.data.push({\n          label: d.target,\n          data: xy,\n          yaxis: 1,\n          stats: {\n            max: maxy,\n            logmin: logminy\n          }\n        });\n        this.plotdata.timestamps[d.target] = ts;\n      });\n\n      //console.log('DATA: ', this.plotdata);\n    }\n\n    this.render();\n  }\n\n  createPlotHoverHandler(event, pos, item) {\n    return (event, pos, item) => {\n      if (item) {\n        const ts = this.plotdata.timestamps[item.series.label][item.dataIndex];\n        const y = { label: item.series.label, value: item.datapoint[1] };\n        const x = { label: this.plotdata.xlabel, value: item.datapoint[0] };\n\n        var body = '<div class=\"graph-tooltip-time\">'+ this.dashboard.formatDate(moment(ts)) +'</div>';\n        body += \"<center>\";\n        body += '<div class=\"graph-tooltip-list-item\">';\n        body += '<div class=\"graph-tooltip-series-name\"><i class=\"fa fa-minus\" style=\"color:' + item.series.color + ';\"></i> ' + x.label + ' (x): </div>';\n        body += '<div class=\"graph-tooltip-value\">' + x.value.toPrecision(4) + '</div>';\n        body += '</div>'\n        body += '<div class=\"graph-tooltip-list-item\">';\n        body += '<div class=\"graph-tooltip-series-name\"><i class=\"fa fa-minus\" style=\"color:' + item.series.color + ';\"></i> ' + y.label + ' (y): </div>';\n        body += '<div class=\"graph-tooltip-value\">' + y.value.toPrecision(4) + '</div>';\n        body += '</div>'\n        body += \"</center>\";\n\n        this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n      } else {\n        this.$tooltip.detach();\n      }\n    };\n  }\n\n  translateFillOption(fill) {\n    return fill === 0 ? 0.001 : fill/10;\n  }\n\n  addXAxis(options) {\n    options.xaxis = {\n      show: this.panel.xaxis.show,\n      min: this.panel.xaxis.min ? _.toNumber(this.panel.xaxis.min) : null,\n      max: this.panel.xaxis.max ? _.toNumber(this.panel.xaxis.max) : null,\n      label: this.panel.xaxis.label\n    };\n  }\n\n  addYAxes(options) {\n    const defaults = {\n      position: 'left',\n      show: this.panel.yaxes[0].show,\n      index: 1,\n      logBase: this.panel.yaxes[0].logBase || 1,\n      min: this.panel.yaxes[0].min ? _.toNumber(this.panel.yaxes[0].min) : null,\n      max: this.panel.yaxes[0].max ? _.toNumber(this.panel.yaxes[0].max) : null,\n    };\n\n    options.yaxes.push(defaults);\n\n    if (_.find(this.plotdata.data, {yaxis: 2})) {\n      var secondY = _.clone(defaults);\n      secondY.index = 2;\n      secondY.show = this.panel.yaxes[1].show;\n      secondY.logBase = this.panel.yaxes[1].logBase || 1;\n      secondY.position = 'right';\n      secondY.min = this.panel.yaxes[1].min ? _.toNumber(this.panel.yaxes[1].min) : null;\n      secondY.max = this.panel.yaxes[1].max ? _.toNumber(this.panel.yaxes[1].max) : null;\n      options.yaxes.push(secondY);\n\n      this.applyLogScale(options.yaxes[1], this.plotdata.data);\n      //configureAxisMode(options.yaxes[1], panel.percentage && panel.stack ? \"percent\" : panel.yaxes[1].format);\n    }\n    this.applyLogScale(options.yaxes[0], this.plotdata.data);\n    this.configureAxisMode(options.yaxes[0], this.panel.yaxes[0].format);\n  }\n\n  applyLogScale(axis, data) {\n    if (axis.logBase === 1) {\n      return;\n    }\n    if (axis.min < Number.MIN_VALUE) {\n      axis.min = null;\n    }\n    if (axis.max < Number.MIN_VALUE) {\n      axis.max = null;\n    }\n\n    var series, i;\n    var max = axis.max, min = axis.min;\n\n    for (i = 0; i < data.length; i++) {\n      series = data[i];\n      if (series.yaxis === axis.index) {\n        if (!max || max < series.stats.max) {\n          max = series.stats.max;\n        }\n        if (!min || min > series.stats.logmin) {\n          min = series.stats.logmin;\n        }\n      }\n    }\n\n    axis.transform = function(v) { return (v < Number.MIN_VALUE) ? null : Math.log(v) / Math.log(axis.logBase); };\n    axis.inverseTransform  = function (v) { return Math.pow(axis.logBase,v); };\n\n    if (!max && !min) {\n      max = axis.inverseTransform(+2);\n      min = axis.inverseTransform(-2);\n    } else if (!max) {\n      max = min*axis.inverseTransform(+4);\n    } else if (!min) {\n      min = max*axis.inverseTransform(-4);\n    }\n\n    if (axis.min) {\n      min = axis.inverseTransform(Math.ceil(axis.transform(axis.min)));\n    } else {\n      min = axis.min = axis.inverseTransform(Math.floor(axis.transform(min)));\n    }\n    if (axis.max) {\n      max = axis.inverseTransform(Math.floor(axis.transform(axis.max)));\n    } else {\n      max = axis.max = axis.inverseTransform(Math.ceil(axis.transform(max)));\n    }\n\n    if (!min || min < Number.MIN_VALUE || !max || max < Number.MIN_VALUE) {\n      return;\n    }\n\n    axis.ticks = [];\n    var nextTick;\n    for (nextTick = min; nextTick <= max; nextTick *= axis.logBase) {\n      axis.ticks.push(nextTick);\n    }\n    axis.tickDecimals = this.decimalPlaces(min);\n  }\n\n  decimalPlaces(num) {\n    if (!num) { return 0; }\n\n    return (num.toString().split('.')[1] || []).length;\n  }\n\n  configureAxisMode(axis, format) {\n    axis.tickFormatter = function(val, axis) {\n      return kbn.valueFormats[format](val, axis.tickDecimals, axis.scaledDecimals);\n    };\n  }\n\n  setUnitFormat(axis, subItem) {\n    axis.format = subItem.value;\n    this.render();\n  }\n\n  drawHook(plot) {\n    // Update legend values\n    var yaxis = plot.getYAxes();\n    for (var i = 0; i < this.plotdata.data.length; i++) {\n      var series = this.plotdata.data[i];\n      var axis = yaxis[series.yaxis - 1];\n      var formater = kbn.valueFormats[this.panel.yaxes[series.yaxis - 1].format];\n\n      // decimal override\n      if (_.isNumber(this.panel.decimals)) {\n        //series.updateLegendValues(formater, this.panel.decimals, null);\n      } else {\n        // auto decimals\n        // legend and tooltip gets one more decimal precision\n        // than graph legend ticks\n        var tickDecimals = (axis.tickDecimals || -1) + 1;\n        //series.updateLegendValues(formater, tickDecimals, axis.scaledDecimals + 2);\n      }\n\n      if (!this.$rootScope.$$phase) { this.$scope.$digest(); }\n    }\n\n    // add left axis labels\n    if (this.panel.yaxes[0].label) {\n      var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label flot-temp-elem'></div>\")\n      .text(this.panel.yaxes[0].label)\n      .appendTo($('#' + this.panelId));\n    }\n\n    // add right axis labels\n    /*if (this.panel.yaxes[1].label) {\n      var rightLabel = $(\"<div class='axisLabel right-yaxis-label flot-temp-elem'></div>\")\n      .text(this.panel.yaxes[1].label)\n      .appendTo($('#' + this.panelId));\n    }*/\n\n    this.thresholdManager.draw(plot);\n  }\n\n  processOffsetHook(plot, gridMargin) {\n    var left = this.panel.yaxes[0];\n    //var right = this.panel.yaxes[1];\n    if (left.show && left.label) { gridMargin.left = 20; }\n    //if (right.show && right.label) { gridMargin.right = 20; }\n\n    // apply y-axis min/max options\n    var yaxis = plot.getYAxes();\n    //for (var i = 0; i < yaxis.length; i++) {\n    var axis = yaxis[0];\n    var panelOptions = this.panel.yaxes[0];\n    axis.options.max = panelOptions.max;\n    axis.options.min = panelOptions.min;\n    //}\n  }\n}\nTwoDPanelCtrl.templateUrl = 'module.html';\n\nexport {\n  TwoDPanelCtrl as PanelCtrl\n};\n"]}